<link rel="import" href="/vendor/polymer/polymer.html">
<polymer-element name="page-planet" attributes="planets showkey">
    <template>
        <!-- <link rel="stylesheet" type="text/css" href="/vendor/bootstrap-3.3.2/bootstrap.min-3.3.2.css">
        <link rel="stylesheet" type="text/css" href="/css/cosmos.css"> -->
        <style>
        :host table {
            width: 100%;
        }
        
        :host thead > tr {
            border-bottom: 2px solid #575757;
            height: 48px;
        }
        
        :host tbody > tr.outer {
            height: 48px;
            color: #bebebe;
        }
        
        :host tbody > tr.inner {
            border-bottom: 1px solid #424242;
            color: #bebebe;
        }
        
        :host tbody > tr > td > paper-checkbox {
            margin-top: 7px;
        }
        </style>
        <h3>Planets</h3>
        <div class="card">
            <table>
                <thead>
                    <tr>
                        <th width="30"></th>
                        <th>Name</th>
                    </tr>
                </thead>
                <tbody>
                    <template repeat="{{planet in planets}}">
                        <tr class="outer">
                            <td class="check">
                                <paper-checkbox id="{{ planet['Name'] }}" checked?="{{ planet['Name'] == _key }}" on-core-change="{{onCheckChanged}}"></paper-checkbox>
                            </td>
                            <td>
                                <b>{{ planet['Name'] }}</b>
                            </td>
                        </tr>
                        <tr class="inner" hidden?="{{ planet['Name'] != _key  }}">
                            <td colspan="2">
                                <template repeat="{{ key in keys(containers[planet['Name']]) }}">
                                    <div style="padding-bottom:10px;padding-left:30px;">
                                        <span><a id="{{ key }}" href="#" on-click="{{ onContainerNameClick }}">{{ containerName(containers[planet['Name']][key]['Names.0'][3]) }}</a></span>
                                        <span>{{ substr(containers[planet['Name']][key]['Id'][3]) }}</span>
                                        <span>{{ containers[planet['Name']][key]['Status'][3] }}</span>
                                    </div>
                                </template>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </template>
    <script>
    Polymer('page-planet', {
        created: function() {
            this.planets = []; // type hint
            this.containers = {};
            this.showKey = undefined;
            this._key = undefined;
        },
        keys: function(obj) {
            if (obj) {
                return Object.keys(obj);
            } else {
                return [];
            }
        },
        showKeyChanged: function() {
        	this._key = this.showKey;
        }, 
        substr: function(str) {
            return str.substring(0, 10);
        },
        containerName: function(str) {
            var comp = str.split('/');
            return comp[comp.length - 1];
        },
        onContainerNameClick: function(event, detail, sender) {
            var pageContainer = document.querySelector('page-container');
            pageContainer.showKey = sender.id

            // Move to Container Tab
            window.CosmosTabs.selected = 2;
        },
        onCheckChanged: function(event, detail, sender) {
            var self = this;
            var checkboxes = $(sender).closest('tbody').find('paper-checkbox');
            var checkCnt = 0;   

            if (!sender.checked) return ;

            self._key = sender.id;

            Cosmos.request.getContainers(sender.id, function(json) {
                self.containers[sender.id] = json;
            }, function(jqXHR) {
                alert('request failed - ' + jqXHR.responseText);
            });
        }
    });
    </script>
</polymer-element>
