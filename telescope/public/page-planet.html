<link rel="import" href="/vendor/polymer/polymer.html">
<dom-module id="page-planet">
<style>
.container {
  width: 100%;
  margin: 0 auto;
  padding: 0;
}

@media (min-width: 1080px) {
  .container {
    width: 1080px;
    marign: 0 auto;
  }
}

@media (min-width: 1400px) {
  .container {
    width: 1400px;
    margin: 0 auto;
  }
}

.row {
  margin: 0;
  padding: 0;
}

.left-container {
  width: 100%;
  margin: 0;
  padding: 0;
}

@media (min-width: 1080px) {
  .left-container {
    width: 260px;
  }
}

@media (min-width: 1400px) {
  .left-container {
    width: 320px;
  }
}

.planet-list {
  margin: 0;
  padding: 20px 0;
  list-style: none;
}

.planet-list li {
  border-bottom: 1px solid #333;
  display: block;
}

.planet-list li:hover {
  background-color: #489dff;
}

.planet-list li a {
  padding: 10px 10px;
  color: #bbb;
  display: block;
  text-decoration: none;
}

.planet-list li a:hover {
  color: #fff;
}

.main-container {
  width: 100%;
  margin: 0;
  padding: 0;
}

@media (min-width: 1080px) {
  .main-container {
    width: 720px;
  }
}

@media (min-width: 1400px) {
  .main-container {
    width: 1080px;
  }
}

.search {
  padding: 10px 20px;
  background-color: #333;
}

.search input {
  width: 100%;
  background-color: #333;
  outline: none;
  border: none;
  color: #fff;
}
</style>
<template>

  <div class="container">

    <div class="row">

      <div class="left-container col-md-4 col-xs-12">
        <div class="search">
          <input id="search-input" type="text" placeholder="search" style="" />
        </div>

        <ul class="planet-list">
          <template is="x-repeat" items="{{data}}">
            <li><a href="/containers">{{item.Planet}}</a></li>
          </template>
        </ul>
      </div>

      <div class="main-container col-md-8 col-xs-12">
      </div>

    </div>

  </div>
</template>
</dom-module>
<script>
Polymer({
  is: 'page-planet',
  properties: {
    data: {
      type: Array,
      value: []
    }
  },
  ready: function() {
    var self = this;
    Cosmos.getPlanets(function(json) {
      self.data = json;
      self.attached();
    }, function(jqXHR) {
      console.log(jqXHR.responseText);
    });
  },
  onPlanetClicked: function(e) {
    e.preventDefault();
    var self = this;
    var target = $(e.currentTarget);
    // show planet metrics
  },
  attached: function() {
    if (this.data.length <= 0 || !history.state || !history.state.key) return;
    var jqElem = $(this);
    var self = this;

    var callback = function() {
      var checkboxes = jqElem.find('input[type=checkbox]');
      if (checkboxes.size() > 0) {
        checkboxes.each(function(i, elem) {
          var input = $(elem);
          if (input.val() == history.state.key) {
            input.prop('checked', true);
            self.onCheckChanged({
                target: elem
            });
          }
        });
      } else {
        setTimeout(callbak, 50);
      }
    };
    setTimeout(callbak, 50);
  },
  showContainers: function(key, e) {
    var self = this;
    var sender = e.target || e.srcElement;

    Cosmos.getContainers(key, function(json) {
      var elem = document.createElement('planet-containers');
      elem.data = json;
      var innerTr = $(sender).closest('tr').next();
      innerTr.show();
      innerTr.find('td').empty();
      Polymer.dom(innerTr.find('td')[0]).appendChild(elem);
    }, function(jqXHR) {
      alert('request failed - ' + jqXHR.responseText);
    });
  }
});
</script>
